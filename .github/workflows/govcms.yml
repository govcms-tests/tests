name: GovCMS CI Tests

on:
  push:
    branches: [ "3.x-develop" ]
  pull_request:
    branches: [ "3.x-develop" ]

permissions:
  contents: read

jobs:
  cypress:
    runs-on: ubuntu-latest

    container:
      image: govcmstesting/ci:8.2-nginx
      options: --user govcms:govcms
      env:
        COMPOSER_HOME: /home/govcms/.cache/composer
        npm_config_cache: /home/govcms/.cache/npm
        CYPRESS_CACHE_FOLDER: /home/govcms/.cache/cypress
       
    steps:
    - name: Start GovCMS
      run: |
       govcms start

    - name: Install dependencies
      run: |
        cd /app/tests/cy && npm ci

    - name: Run Cypress tests
      run: |
        cd /app/tests/cy && npx cypress run --env drupalDrushCmdLine="/app/bin/drush --root=/app/web %command"
